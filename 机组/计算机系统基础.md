# 计算机系统基础（实验）笔记

## PA2

NEMU初始化

c文件——ELF file——binary（内存镜像文件）

初始化：磁盘内容拷贝到模拟内存/初始化EIP（使第一条EIP指向程序执行的第一条指令）/初始化ESP（初始到内存的最高地址——栈）

指令序列的执行：辨别指令/取数据/执行/写回数据

指令的解码与执行：opcode（前面为前缀（若前缀为0x66，则为16位指令集，若没有则为32位指令集），后面为数据形式）

opcode通过I386的opcode map，opcode字节后方（可能有）ModR/M字节（register or memory address），mod决定数据在内存还是在寄存器中，MODR/M中会决定后面是否有SIB字节，SIB字节给寻址方式：基址加..变址加偏移量，内存地址为disp32[..][..],SIB后面有小段方式的偏移量，后面为placement和immediate number

模拟译码和执行

- 查手册：辨别指令形式，操作数为16位或32位
- 指令名称/源和目的操作数/长度后缀
- 写操作码对应的instr_func——确定操作数的长度，跳过opcode,读取MODER/M字节

